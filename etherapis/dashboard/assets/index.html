<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Ether APIs Dashboard</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.6/slate/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div id="content"></div>

    <script>
      ajax = function(url, success) {
        $.ajax({url: url, dataType: 'json', cache: false, success: success,
          error: function(xhr, status, err) {
            console.error(url, status, err.toString());
          }.bind(this)
        });
      }
    </script>

    <script type="text/babel">
      var EthereumPeers = React.createClass({
        refreshPeers: function() {
          ajax(this.props.url, function(data) { this.setState({data: data.length}); }.bind(this));
        },
        getInitialState: function() {
          return {data: 0};
        },
        componentDidMount: function() {
          this.refreshPeers();
          setInterval(this.refreshPeers, this.props.refresh);
        },
        render: function() {
          return (<span className="navbar-text"><i className="fa fa-rss"></i> {this.state.data} peers</span>);
        }
      });
      var EthereumBlocks = React.createClass({
        refreshBlocks: function() {
          ajax(this.props.url, function(block) { this.setState({block: block}); }.bind(this));
        },
        getInitialState: function() {
          return {block: {number: 0, timestamp: 0}};
        },
        componentDidMount: function() {
          this.refreshBlocks();
          setInterval(this.refreshBlocks, this.props.refresh);
        },
        render: function() {
          return (
            <span>
              <span className="navbar-text"><i className="fa fa-database"></i> {parseInt(this.state.block.number, 16)} blocks</span>
              <span className="navbar-text"><i className="fa fa-clock-o"></i> {moment.unix(this.state.block.timestamp).fromNow()}</span>
            </span>
          );
        }
      });

      var Dashboard = React.createClass({
        getInitialState: function() {
          return {blocks: 0, time: 0};
        },
        render: function() {
          return (
            <nav className="navbar navbar-fixed-top">
              <div className="container">
                <div className="navbar-header">
                  <span className="navbar-brand">Ether APIs Dashboard</span>
                </div>
                <div id="navbar" className="navbar-collapse collapse">
                  <form className="navbar-right">
                    <EthereumPeers url="/api/ethereum/peers" refresh={1000}/>
                    <EthereumBlocks url="/api/ethereum/head" refresh={1000}/>
                  </form>
                </div>
              </div>
            </nav>
          );
        }
      });
      ReactDOM.render(<Dashboard />, document.getElementById('content'));
    </script>
  </body>
</html>
